<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abundance Token - Village Node</title>
    <link rel="stylesheet" href="style.css?v=2.1">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- D3.js for DAG Visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Engagement System -->
    <script src="engagement.js"></script>
    <script src="activity_feed.js"></script>
    <!-- Leaflet for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <!-- Marked.js for Markdown Rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Hardware Monitor -->
    <script src="hardware_monitor.js"></script>
    <script src="mobility_module.js"></script>
    <script src="sound_engine.js"></script>
    <link rel="manifest" href="manifest.json">


    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ark OS">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- iOS Startup Images (Splash Screens) -->
    <link rel="apple-touch-startup-image" href="icon-512.png">

    <meta name="theme-color" content="#10B981">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Ark OS">
    <meta name="msapplication-TileColor" content="#0f172a">

    <script>
        // Unified Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => {
                        console.log('[SW] PWA Registered:', reg.scope);
                        // Register for background sync if available
                        if ('sync' in reg) {
                            reg.sync.register('sync-queue').catch(e => {
                                console.warn('[SW] Sync registration denied or failed:', e);
                            });
                        }
                    })
                    .catch(err => console.error('[SW] Registration failed:', err));
            });
        }
    </script>
    <style>
        /* Sidebar Nav Styles */
        .nav-item {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            padding: 12px 16px;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover {
            background: rgba(16, 185, 129, 0.1);
            color: #34D399;
            /* primary-light */
            transform: translateX(4px);
        }

        .nav-item.active {
            background: rgba(16, 185, 129, 0.1);
            color: #10B981;
            font-weight: 600;
            border-left: 3px solid #10B981;
        }

        /* Map Fix */
        .leaflet-container {
            background: #0f172a;
            /* Match theme background while loading */
        }
    </style>
</head>

<body>
    <div class="background-glow"></div>
    <div id="ark-notifications"
        style="position: fixed; top: 20px; right: 20px; z-index: 10005; display: flex; flex-direction: column; gap: 10px; pointer-events: none;">
    </div>

    <!-- MAIN APP LAYOUT (Sidebar + Content) -->
    <button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞ Menu</button>
    <div class="civ-container" style="display: flex; width: 100%; height: 100vh; overflow: hidden;">

        <!-- SIDEBAR NAVIGATION -->
        <aside class="civ-sidebar glass-panel">
            <!-- Brand -->
            <div
                style="padding: 24px; border-bottom: 1px solid var(--glass-border); background: rgba(0,0,0,0.1); flex-shrink: 0;">
                <div class="logo">
                    <div class="logo-icon" id="main-logo" onclick="window.runDiagnostic()"
                        title="System Health Diagnostic"></div>
                    <div style="display: flex; flex-direction: column;">
                        <h1
                            style="font-size: 1.4rem; color: var(--primary); margin: 0; font-weight: 800; letter-spacing: -0.5px;">
                            Ark <span class="highlight" style="color: var(--primary-light);">OS</span></h1>
                        <span id="kardashev-badge"
                            style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; font-weight: 600;">Type
                            0.72 Civilization</span>
                    </div>
                </div>
            </div>

            <!-- Scrollable Nav Section -->
            <div style="flex-grow: 1; overflow-y: auto; scrollbar-width: none;">
                <!-- User Profile -->
                <div style="padding: 20px; text-align: center;">
                    <div class="avatar-circle"
                        style="width: 60px; height: 60px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid rgba(16, 185, 129, 0.2);">
                        üë§</div>
                    <div style="font-size: 0.9rem; font-weight: 600; color: var(--primary-light);"
                        id="sidebar-username">
                        Guest</div>
                    <div class="xp-container-premium">
                        <div class="level-badge-large" id="sidebar-level">LVL 1</div>
                        <div
                            style="font-size: 0.75rem; color: var(--text-muted); display: flex; justify-content: space-between;">
                            <span>Progress</span>
                            <span id="xp-text">0 / 1000 XP</span>
                        </div>
                        <div class="xp-bar-premium">
                            <div id="xp-fill-sidebar" class="xp-fill-premium"></div>
                        </div>

                        <!-- Time Movie Stats -->
                        <div
                            style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.1);">
                            <div
                                style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">
                                Sovereign Time</div>
                            <div id="time-wealth-display"
                                style="font-size: 1rem; font-weight: 700; color: #10B981; margin: 4px 0;">+0.00 <span
                                    style="font-size: 0.7rem;">HRS LIBERATED</span></div>
                            <div id="life-clock"
                                style="font-size: 0.7rem; color: #EF4444; font-family: 'JetBrains Mono'; opacity: 0.8;">
                                EST.
                                1,987,654,321s REMAINING</div>
                        </div>

                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-top: 8px; text-align: center;"
                            id="sidebar-balance">
                            0.00 <span style="font-size:0.8rem; color:var(--text-muted);">AT</span>
                        </div>
                    </div>
                </div>

                <!-- Navigation Links -->
                <nav class="sidebar-menu" style="padding: 0 10px;">
                    <div
                        style="padding-left: 15px; margin-bottom: 8px; font-size: 10px; color: var(--text-muted); text-transform: uppercase;">
                        Missions</div>
                    <button class="nav-item active" onclick="switchView('dashboard')">üöÄ Mission Control</button>
                    <button class="nav-item" onclick="switchView('jobs')">üìã Job Board</button>
                    <button class="nav-item" onclick="switchView('wallet')">üí∞ Wallet</button>
                    <button class="nav-item" onclick="switchView('techtree')">üß¨ Tech Tree</button>
                    <button class="nav-item" onclick="switchView('evolution')">üìà Evolution</button>

                    <div
                        style="margin-top: 20px; padding-left: 15px; margin-bottom: 8px; font-size: 10px; color: var(--text-muted); text-transform: uppercase;">
                        Infrastructure</div>
                    <button class="nav-item" onclick="switchView('builddeck')">üèéÔ∏è Build Deck</button>
                    <button class="nav-item" onclick="switchView('wiki')">üìö Knowledge Base</button>
                    <button class="nav-item" onclick="switchView('chronicle')">üìú The Chronicle</button>
                    <button class="nav-item" onclick="switchView('leaderboard')">ü•á Leaderboard</button>
                    <button class="nav-item" onclick="switchView('mesh')">üåê Mesh Map</button>
                    <button class="nav-item" onclick="switchView('hardware')">üõ†Ô∏è Infrastructure</button>

                    <div
                        style="margin-top: 20px; padding-left: 15px; margin-bottom: 8px; font-size: 10px; color: var(--text-muted); text-transform: uppercase;">
                        Intelligence</div>
                    <button class="nav-item" onclick="switchView('tangle')">‚õìÔ∏è Live Tangle</button>
                    <button class="nav-item" onclick="switchView('steward_ai')">ü§ñ Steward AI</button>
                    <button class="nav-item" onclick="switchView('mycelium')">üåø The Mycelium</button>
                    <button class="nav-item" onclick="switchView('mobility')">üõ∏ Universal Mobility</button>
                </nav>

                <div
                    style="margin-top: 20px; padding-left: 15px; font-size: 10px; color: var(--text-muted); text-transform: uppercase;">
                    System Tools</div>
                <button class="nav-item" onclick="window.location.href='verifier.html'">‚öñÔ∏è Verifier</button>
                <button class="nav-item" onclick="switchView('console')" style="color:#10B981;">‚ö°
                    Console</button>
                <div
                    style="margin-top: 20px; border-top: 1px solid rgba(16,185,129,0.1); padding-top: 10px; padding-bottom: 20px;">
                    <button class="nav-item" onclick="switchView('auth')" style="color: #60A5FA;">üîê Sovereign
                        Access</button>
                    <button class="nav-item" onclick="window.openFeedbackForm()" style="color: #F87171;">üêû Report
                        Bug</button>
                </div>
            </div>
            </nav>

            <!-- Status Footer -->
            <div style="padding: 15px; background: rgba(0,0,0,0.2); font-size: 11px; color: var(--text-muted);">
                <div style="margin-bottom: 10px; border-bottom: 1px solid rgba(16,185,129,0.1); padding-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Server</span><span style="color:#10B981;">ONLINE</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Mesh</span><span style="color:#10B981;">ACTIVE</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Steward</span><span id="steward-status-led"
                            style="color:var(--primary-light);">ON-LINE</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>Wait Time</span>
                    <span style="color: #10B981;">12ms</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Network</span>
                    <span style="color: #10B981;">‚óè Online</span>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="civ-content"
            style="flex: 1; padding: 30px; overflow-y: auto; scroll-behavior: smooth; position: relative;">

            <!-- Zen Navigation Bar (Visible in modules) -->
            <div id="zen-nav"
                style="display: none; justify-content: space-between; align-items: center; margin-bottom: 20px; animation: zenFadeIn 0.3s ease-out;">
                <button onclick="window.switchView('dashboard')" class="btn-xs"
                    style="background: rgba(16,185,129,0.1); border: 1px solid var(--glass-border); color: var(--primary-light); padding: 8px 16px;">‚¨Ö
                    Back to Town Square</button>
                <button onclick="window.toggleZenMode()" class="btn-xs"
                    style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.2); color: var(--secondary); padding: 8px 16px;">üßò
                    Zen Focus</button>
            </div>

            <!-- VIEW: DASHBOARD (Home) -->
            <div id="view-dashboard" class="app-view">
                <!-- Kardashev Pulse Telemetry (Feng Shui Refined) -->
                <div class="glass-panel"
                    style="margin-bottom: 30px; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--secondary); background: linear-gradient(90deg, rgba(139, 92, 246, 0.05), transparent); border-radius: 16px;">
                    <div style="display: flex; gap: 50px;">
                        <div>
                            <div
                                style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">
                                Node Consumption</div>
                            <div style="display: flex; align-items: baseline; gap: 5px;">
                                <span id="node-power-watts"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--primary-light);">15.4</span>
                                <span
                                    style="font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">WATT</span>
                            </div>
                        </div>
                        <div>
                            <div
                                style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">
                                Total Energy (Yield)</div>
                            <div style="display: flex; align-items: baseline; gap: 5px;">
                                <span id="node-energy-kwh"
                                    style="font-size: 1.4rem; font-weight: 800; color: var(--accent);">0.0004</span>
                                <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">kWh</span>
                            </div>
                        </div>
                        <div class="desktop-only">
                            <div
                                style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">
                                Humanity Aggregate</div>
                            <div style="display: flex; align-items: baseline; gap: 5px;">
                                <span style="font-size: 1.4rem; font-weight: 800; color: var(--secondary);">18.0</span>
                                <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">TW</span>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div
                            style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">
                            Kardashev Pulse</div>
                        <div id="kardashev-realtime"
                            style="font-size: 1.2rem; font-weight: 800; color: var(--secondary); text-shadow: 0 0 10px var(--secondary-glow);">
                            0.72419842</div>
                    </div>
                </div>

                <header
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <div>
                        <h2 style="font-size: 2.2rem; font-weight: 800; letter-spacing: -1px; margin: 0;">Town Square
                        </h2>
                        <p style="color: var(--text-muted); font-size: 1rem;">The rhythmic heart of your sovereign
                            domain.
                        </p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="nav-item" onclick="switchView('mesh')"
                            style="background: rgba(139, 92, 246, 0.1); color: var(--secondary); border: 1px solid rgba(139, 92, 246, 0.2); padding: 10px 20px;">üåê
                            Mesh Map</button>
                        <button class="btn-primary" onclick="switchView('mint')"
                            style="box-shadow: 0 8px 16px var(--primary-glow);">+ Mint Labor</button>
                    </div>
                </header>

                <!-- Widgets Grid -->
                <div class="grid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">

                    <!-- Widget: Live Feed (Chat) -->
                    <div class="glass-panel"
                        style="height: 350px; overflow: hidden; display: flex; flex-direction: column;">
                        <div class="section-header">
                            <h3>üìú Town Square</h3>
                            <select id="chat-channel-selector" onchange="window.switchChannel(this.value)"
                                style="background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: var(--primary-light); font-size: 0.7rem; border-radius: 4px; padding: 2px 5px;">
                                <option value="general">üåç General</option>
                                <option value="squad_alpha">üõ°Ô∏è Squad Alpha</option>
                                <option value="squad_beta">üõ†Ô∏è Squad Beta</option>
                                <option value="intel">üõ∞Ô∏è Intel Swarm</option>
                            </select>
                        </div>
                        <!-- Network Graph (D3) -->
                        <div id="network-graph-dashboard"
                            style="height: 150px; width: 100%; border-bottom: 1px solid rgba(16,185,129,0.1); position: relative; overflow: hidden;">
                            <canvas id="traffic-canvas" style="width:100%; height:100%;"></canvas>
                        </div>
                        <div id="terminal-log"
                            style="flex: 1; overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 0.8rem; color: var(--text-main); padding: 10px; border-bottom: 1px solid rgba(16,185,129,0.1);">
                            <!-- Chat Stream -->
                        </div>
                        <div style="padding: 10px; display: flex; gap: 5px;">
                            <input type="text" id="chat-input" placeholder="Say something..." class="input-dark"
                                style="flex: 1; padding: 8px;">
                            <button onclick="sendChat()" class="btn-secondary"
                                style="background: rgba(16,185,129,0.1);">‚û§</button>
                        </div>
                    </div>



                    <!-- Widget: Right Column -->
                    <div style="display: flex; flex-direction: column; gap: 20px;">

                        <!-- Widget: Stats (Mini Gaia) -->
                        <div class="glass-panel">
                            <div class="section-header">
                                <h3>üìä Community Pulse</h3>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                <div class="stat-box"
                                    style="background: rgba(16, 185, 129, 0.05); padding: 15px; border-radius: 8px; text-align: center; border: 1px solid rgba(16, 185, 129, 0.1);">
                                    <div id="dash-mint-count" style="font-size: 24px; color: var(--primary-light);">0
                                    </div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Validated Mints</div>
                                </div>
                                <div class="stat-box"
                                    style="background: rgba(16, 185, 129, 0.05); padding: 15px; border-radius: 8px; text-align: center; border: 1px solid rgba(16, 185, 129, 0.1);">
                                    <div id="dash-block-count" style="font-size: 24px; color: var(--primary);">742</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Ark Blocks</div>
                                </div>
                            </div>
                            <!-- Metabolic Yield Progress -->
                            <div
                                style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.1);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <span
                                        style="font-size: 0.75rem; color: var(--primary); font-weight: 600; text-transform: uppercase;">Metabolic
                                        Yield</span>
                                    <span id="metabolic-yield-value"
                                        style="font-size: 0.9rem; color: var(--primary-light); font-weight: bold;">0%</span>
                                </div>
                                <div
                                    style="width: 100%; height: 6px; background: rgba(16, 185, 129, 0.1); border-radius: 3px; overflow: hidden;">
                                    <div id="metabolic-yield-fill"
                                        style="width: 0%; height: 100%; background: var(--primary); box-shadow: 0 0 10px var(--primary-glow); transition: width 1s ease;">
                                    </div>
                                </div>
                                <div style="font-size: 0.65rem; color: var(--text-muted); margin-top: 8px;">Efficiency
                                    of localized resource capture and conversion.</div>
                            </div>
                        </div>

                        <!-- Widget: Quick Mint -->
                        <div class="glass-panel" style="margin-top: 20px;">
                            <div class="section-header">
                                <h3>‚ö° Quick Mint</h3>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px;">
                                <button onclick="quickMint(1)" class="btn-primary"
                                    style="font-size: 0.85rem; padding: 12px 8px;">
                                    1h<br><span style="font-size: 0.7rem; opacity: 0.8;">10 AT</span>
                                </button>
                                <button onclick="quickMint(2)" class="btn-primary"
                                    style="font-size: 0.85rem; padding: 12px 8px;">
                                    2h<br><span style="font-size: 0.7rem; opacity: 0.8;">20 AT</span>
                                </button>
                                <button onclick="quickMint(4)" class="btn-primary"
                                    style="font-size: 0.85rem; padding: 12px 8px;">
                                    4h<br><span style="font-size: 0.7rem; opacity: 0.8;">40 AT</span>
                                </button>
                                <button onclick="quickMint(8)" class="btn-primary"
                                    style="font-size: 0.85rem; padding: 12px 8px;">
                                    8h<br><span style="font-size: 0.7rem; opacity: 0.8;">80 AT</span>
                                </button>
                            </div>
                            <div id="streak-display"
                                style="margin-top: 12px; text-align: center; font-size: 14px; color: #FBBF24;">
                                üî• 0 Day Streak
                            </div>
                        </div>

                        <!-- Widget: Activity Feed -->
                        <div class="glass-panel" style="margin-top: 20px;">
                            <div class="section-header">
                                <h3>üì° Live Activity</h3>
                            </div>
                            <div id="activity-feed"
                                style="max-height: 250px; overflow-y: auto; margin-top: 10px; font-size: 0.85rem;">
                                <!-- Populated by activity_feed.js -->
                            </div>
                        </div>
                    </div>

                    <!-- Widget: Network Control (New) -->
                    <div class="glass-panel"
                        style="flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
                        <div class="section-header">
                            <h3>üì° Network Control</h3>
                            <div class="badge" id="sim-status-badge"
                                style="background: rgba(16,185,129,0.1); color: var(--text-muted);">STANDBY</div>
                        </div>
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
                            <span style="font-size: 0.9rem; color: var(--text-main);">Traffic Sim</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sim-toggle" onchange="toggleSimulationUI()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">
                            Generates random transactions to stress-test the ledger.
                        </div>
                    </div>

                    <!-- Widget: Calendar -->
                    <div class="glass-panel" style="flex: 1;">
                        <div class="section-header">
                            <h3>üß¨ Active Missions</h3>
                        </div>
                        <div id="active-missions-list"
                            style="margin-top: 10px; display: flex; flex-direction: column; gap: 8px;">
                            <div
                                style="color: var(--text-muted); font-size: 0.8rem; padding: 20px; text-align: center;">
                                Synchronizing with Global Federation...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <!-- VIEW: JOBS -->
    <div id="view-jobs" class="app-view" style="display: none;">
        <div class="section-header">
            <h2>Job Board (SEH7)</h2>
            <select id="job-filter" onchange="window.filterJobs()"
                style="background: rgba(0,0,0,0.3); border: 1px solid rgba(16,185,129,0.1); color: var(--primary-light); padding: 6px; border-radius: 6px;">
                <option value="ALL">All Missions</option>
                <option value="CRITICAL">üö® Critical</option>
                <option value="GROWTH">üå± Growth</option>
                <option value="KNOWLEDGE">üìö Knowledge</option>
                <option value="EXTREME">üî• Extreme</option>
            </select>
        </div>

        <!-- My Active Jobs -->
        <div style="margin-top: 20px;">
            <h3 style="font-size: 1rem; color: var(--text-muted); margin-bottom: 10px;">üìã My Active Jobs</h3>
            <div id="my-jobs-list">
                <!-- My Jobs Injected Here -->
            </div>
        </div>

        <!-- Open Jobs -->
        <div style="margin-top: 30px;">
            <h3 style="font-size: 1rem; color: var(--text-muted); margin-bottom: 10px;">üîì Open Jobs</h3>
            <div id="seh7-jobs" style="display:flex; flex-direction:column; gap:10px;">
                <!-- Jobs Injected Here -->
            </div>
        </div>
    </div>

    <!-- VIEW: WALLET -->
    <div id="view-wallet" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üí≥ Wallet</h2>
            <p style="color: var(--text-muted);">Your personal Abundance Token account.</p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <!-- Account Card -->
            <div class="glass-panel">
                <div class="section-header">
                    <h3>Account</h3>
                </div>
                <div style="margin-top: 15px;">
                    <div style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Your Address
                    </div>
                    <div id="wallet-address"
                        style="font-family: 'JetBrains Mono'; font-size: 0.85rem; color: #10B981; word-break: break-all; margin-top: 5px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                        Loading...
                    </div>
                </div>
                <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div
                        style="background: rgba(16,185,129,0.05); padding: 15px; border-radius: 8px; text-align: center;">
                        <div id="wallet-balance" style="font-size: 1.8rem; font-weight: 700; color: #10B981;">
                            0.00</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">AT Balance</div>
                    </div>
                    <div
                        style="background: rgba(16,185,129,0.05); padding: 15px; border-radius: 8px; text-align: center;">
                        <div id="wallet-xp" style="font-size: 1.8rem; font-weight: 700; color: #3B82F6;">0</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Total XP</div>
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn-primary" onclick="switchView('mint')" style="flex:1;">+ Mint
                        Labor</button>
                    <button class="btn-secondary" style="flex:1;">‚Üó Send AT</button>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="glass-panel">
                <div class="section-header">
                    <h3>Recent Activity</h3>
                </div>
                <div id="wallet-history" style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                    <div style="text-align: center; padding: 30px; color: var(--text-muted);">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üì≠</div>
                        <p>No transactions yet.</p>
                        <p style="font-size: 0.8rem;">Mint your first labor claim to get started!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: MINT (Hidden Form) -->
    <div id="view-mint" class="app-view" style="display: none;">
        <div class="glass-panel" style="max-width: 600px; margin: 0 auto;">
            <div class="section-header">
                <h3>New Labor Claim</h3>
                <button class="text-btn" onclick="switchView('dashboard')">Cancel</button>
            </div>
            <!-- Reuse existing mint form structure (ID: log-form) -->
            <form id="log-form">
                <div class="form-group">
                    <label for="task-select">Standard Task (SEH7)</label>
                    <select id="task-select" class="input-dark" onchange="updateTaskInfo()">
                        <option value="custom">-- Select Task --</option>
                        <option value="install_outlet" data-st="0.5" data-rate="10">‚ö° Install Outlet (30m)
                        </option>
                        <option value="run_romex" data-st="2.0" data-rate="12">üîå Run Romex (2h)</option>
                        <option value="plumb_rough" data-st="4.0" data-rate="12">üíß Plumbing Rough-in (4h)
                        </option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group half"><label for="hours">Hrs</label><input type="number" id="hours"
                            class="input-dark" min="0.01" step="0.01"></div>
                    <div class="form-group half"><label for="st-display">ST</label><input type="number" id="st-display"
                            class="input-dark" readonly></div>
                </div>
                <button type="submit" id="btn-mint" class="btn-primary">Submit Claim</button>
            </form>
        </div>
    </div>

    <!-- VIEW: COSMOS (Legacy Placeholder) -->
    <div id="view-cosmos" class="app-view" style="display: none;">
        <div class="section-header">
            <h2>üó∫Ô∏è The Cosmos</h2>
            <p style="color: var(--text-muted);">Secondary telemetry visualization.</p>
        </div>
        <div class="glass-panel" style="height: 500px; display:flex; align-items:center; justify-content:center;">
            <div id="project-tree" style="width:100%; height:100%;"></div>
        </div>
    </div>

    <!-- Dynamic Module Views will be inserted here if needed, 
         but we keep core views static for reliability -->
    <div id="view-bounties" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>‚öîÔ∏è The Work</h2>
            <p style="color: var(--text-muted);">Post tasks, claim bounties, and earn AT by serving the village.</p>
            <button class="btn-primary" onclick="window.toggleBountyForm()">+ Create Bounty</button>
        </div>

        <!-- Create Bounty Form (Hidden) -->
        <div id="bounty-form" class="glass-panel" style="display:none; margin-bottom:20px; border:1px solid #F59E0B;">
            <h3 style="color:#F59E0B;">Create New Bounty</h3>
            <div style="display:grid; gap:10px; margin-top:10px;">
                <input type="text" id="b-title" class="input-dark" placeholder="Task Title (e.g. Fix Generator)">
                <textarea id="b-desc" class="input-dark" placeholder="Description of work required..."
                    rows="3"></textarea>
                <input type="number" id="b-reward" class="input-dark" placeholder="Reward (AT)">
                <button onclick="window.createBounty()" class="btn-primary" style="background:#F59E0B;">Post
                    Bounty</button>
            </div>
        </div>

        <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Open Bounties -->
            <div class="glass-panel">
                <h3>üîì Open Bounties</h3>
                <div id="bounties-open" style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                    <!-- JS Injected -->
                </div>
            </div>

            <!-- My Active Tasks -->
            <div class="glass-panel">
                <h3>‚ö° My Active Tasks</h3>
                <div id="bounties-active" style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                    <!-- JS Injected -->
                </div>
            </div>
        </div>

        <div class="glass-panel" style="margin-top:20px;">
            <h3>‚úÖ Verification Queue (My Posted Bounties)</h3>
            <div id="bounties-verify" style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                <!-- JS Injected -->
            </div>
        </div>
    </div>

    <!-- VIEW: INVENTORY (Private Ledger) -->
    <div id="view-inventory" class="app-view" style="display: none;">
        <div class="section-header"
            style="margin-bottom: 20px; border-bottom: 2px solid #60A5FA; padding-bottom: 10px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <h2 style="margin: 0;">üì¶ Personal Inventory</h2>
                <div class="badge"
                    style="background: rgba(96, 165, 250, 0.1); color: #60A5FA; border: 1px solid #60A5FA; font-size: 0.6rem;">
                    PRIVATE SANCTUARY</div>
            </div>
            <p style="color: var(--text-muted);">Sovereign Skillset & Assets. Data remains on your local node.</p>
        </div>

        <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Skills & Masteries -->
            <div class="glass-panel">
                <h3>üõ†Ô∏è Sovereign Skills</h3>
                <div id="skills-list" style="margin-top:15px; display:flex; flex-wrap:wrap; gap:8px;">
                    <!-- Injected JS -->
                </div>
                <div style="margin-top:20px; display:flex; gap:10px;">
                    <input type="text" id="new-skill" class="input-dark" placeholder="Add Skill (e.g. Solar Repair)"
                        style="margin:0;">
                    <button onclick="window.addSovereignSkill()" class="btn-primary"
                        style="padding: 10px 15px;">+</button>
                </div>
            </div>

            <!-- Privacy Gates -->
            <div class="glass-panel" style="border-left: 4px solid #FBBF24;">
                <h3>üõ°Ô∏è Privacy Gates</h3>
                <div style="margin-top:15px; font-size:0.85rem; color:var(--text-main);">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding:10px; background:rgba(16,185,129,0.03); border-radius:8px;">
                        <span>Share Skills with Mesh</span>
                        <input type="checkbox" id="gate-share-skills" checked>
                    </div>
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding:10px; background:rgba(16,185,129,0.03); border-radius:8px;">
                        <span>Share Location for Mesh Map</span>
                        <input type="checkbox" id="gate-share-loc">
                    </div>
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; padding:10px; background:rgba(16,185,129,0.03); border-radius:8px;">
                        <span>Anonymize Wallet History</span>
                        <input type="checkbox" id="gate-anon-wallet">
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-panel" style="margin-top:20px;">
            <h3>üß¨ Biological Inventory (Local LLM Training)</h3>
            <p style="font-size:0.8rem; color:var(--text-muted);">Connect your local health sensors to train your
                Sovereign AI.
                Data never leaves this node.</p>
            <div id="bio-stats-container"
                style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; margin-top:15px;">
                <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:8px; text-align:center;">
                    <div style="font-size:0.7rem; color:var(--text-muted);">SLEEP RECOVERY</div>
                    <div style="font-size:1.2rem; color:#60A5FA; font-weight:bold;">--</div>
                </div>
                <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:8px; text-align:center;">
                    <div style="font-size:0.7rem; color:var(--text-muted);">HEART RATE VARIANCE</div>
                    <div style="font-size:1.2rem; color:#10B981; font-weight:bold;">--</div>
                </div>
                <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:8px; text-align:center;">
                    <div style="font-size:0.7rem; color:var(--text-muted);">COGNITIVE LOAD</div>
                    <div style="font-size:1.2rem; color:#FBBF24; font-weight:bold;">--</div>
                </div>
            </div>
        </div>
    </div>
    <div id="view-techtree" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üß¨ Civilization Tech Tree</h2>
            <p style="color: var(--text-muted);">Unlock technologies by advancing the village evolution.</p>
        </div>
        <div id="tech-tree-container"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
            <!-- Tech Nodes Injected JavaScript -->
        </div>
    </div>

    <!-- VIEW: LEADERBOARD -->
    <div id="view-leaderboard" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üèÖ Top Contributors</h2>
            <p style="color: var(--text-muted);">Recognizing those who build the future.</p>
        </div>
        <div class="glass-panel">
            <table style="width: 100%; border-collapse: collapse; text-align: left;">
                <thead>
                    <tr
                        style="border-bottom: 1px solid rgba(16,185,129,0.1); color: var(--text-muted); font-size: 12px; text-transform: uppercase;">
                        <th style="padding: 10px;">Rank</th>
                        <th style="padding: 10px;">Villager</th>
                        <th style="padding: 10px;">Level</th>
                        <th style="padding: 10px; text-align: right;">Total XP</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Rows Injected JS -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- VIEW: EVOLUTION (Achievements) -->
    <div id="view-evolution" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üß¨ Biological Evolution</h2>
            <p style="color: var(--text-muted);">Your milestones in the OSE Network.</p>
        </div>
        <div id="achievements-container"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
            <!-- Achievements Injected JS -->
        </div>

        <div class="glass-panel" style="margin-top: 30px;">
            <h3>üìÖ Daily Missions</h3>
            <div id="daily-quests" style="margin-top: 15px;">
                <!-- Daily Quests Injected JS -->
            </div>
        </div>
    </div>

    <!-- VIEW: CHRONICLE (Ledger Narrative) -->
    <div id="view-chronicle" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üìú The Chronicle</h2>
            <p style="color: var(--text-muted);">The living historical ledger of the Ark Node.</p>
        </div>
        <div class="glass-panel" style="padding: 0; background: transparent;">
            <div id="chronicle-timeline"
                style="position: relative; padding: 20px; display: flex; flex-direction: column; gap: 30px;">
                <!-- Chronological blocks injected here -->
                <div style="text-align:center; padding:50px; color:var(--text-muted);">
                    Synchronizing Narrative Threads...
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: BUILD DECK (Truck Mission) -->
    <div id="view-builddeck" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üèéÔ∏è Build Deck: FBCC 8 Godzilla</h2>
            <p style="color: var(--text-muted);">Real-time construction telemetry and project progress.</p>
        </div>

        <!-- Project Status Header -->
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div class="glass-panel" style="text-align: center; border-bottom: 3px solid #F59E0B;">
                <span style="font-size: 0.8rem; color: var(--text-muted);">PROJECT COMPLETION</span>
                <div id="truck-completion-pct"
                    style="font-size: 1.8rem; font-weight: bold; color: #F59E0B; margin: 5px 0;">0%</div>
                <div style="height: 6px; background: rgba(16,185,129,0.1); border-radius: 3px; overflow: hidden;">
                    <div id="truck-completion-bar"
                        style="width: 0%; height: 100%; background: #F59E0B; transition: width 1s;"></div>
                </div>
            </div>
            <div class="glass-panel" style="text-align: center; border-bottom: 3px solid #10B981;">
                <span style="font-size: 0.8rem; color: var(--text-muted);">ACTIVE SWARMS</span>
                <div style="font-size: 1.8rem; font-weight: bold; color: #10B981; margin: 5px 0;">4/4</div>
            </div>
            <div class="glass-panel" style="text-align: center; border-bottom: 3px solid #3B82F6;">
                <span style="font-size: 0.8rem; color: var(--text-muted);">BOUNTY POOL</span>
                <div id="truck-bounty-pool"
                    style="font-size: 1.8rem; font-weight: bold; color: #3B82F6; margin: 5px 0;">15k AT</div>
            </div>
        </div>

        <!-- Swarm Progress -->
        <div id="truck-swarms-container"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
            <!-- Swarm Cards Injected JS -->
        </div>

        <div class="glass-panel" style="margin-top: 30px;">
            <h3>üìã Critical Path Items</h3>
            <div id="truck-critical-tasks" style="margin-top: 15px;">
                <!-- Critical Tasks Injected JS -->
            </div>
        </div>
    </div>

    <!-- VIEW: UNIVERSAL MOBILITY -->
    <div id="view-mobility" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 2.5rem;">üõ∏</div>
                <div>
                    <h2 style="margin: 0;">Universal Mobility</h2>
                    <p style="color: var(--text-muted); margin: 0;">Sovereign Travel & Cross-Node Mesh Handoff.</p>
                </div>
            </div>
            <div id="mobility-status-badge" class="badge"
                style="background: rgba(16, 185, 129, 0.1); color: #10B981; border: 1px solid #10B981;">üõ∞Ô∏è SIGNAL
                STABLE</div>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            <!-- Left: Peer Mesh Map & Travel -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="glass-panel" style="padding: 0; position: relative; height: 400px; overflow: hidden;">
                    <div id="mobility-map" style="width: 100%; height: 100%; z-index: 1;"></div>
                    <div
                        style="position: absolute; bottom: 20px; left: 20px; z-index: 2; padding: 15px; background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid rgba(16,185,129,0.1); max-width: 250px;">
                        <h4 style="margin: 0 0 5px 0; font-size: 0.8rem; color: var(--text-muted);">CURRENT DOCK</h4>
                        <div id="current-node-name" style="font-weight: bold; color: #10B981; margin-bottom: 10px;">
                            Factor e Farm (Missouri)</div>
                        <div style="font-size: 0.7rem; color: var(--text-muted);">IP: localhost:3000</div>
                    </div>
                </div>

                <div class="glass-panel">
                    <h3 style="margin-bottom: 15px;">üåê Federated Peer Registry</h3>
                    <div id="peer-nodes-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <!-- Injected by mobility_module.js -->
                    </div>
                </div>
            </div>

            <!-- Right: Handoff & Identity -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="glass-panel" style="border-left: 4px solid #F59E0B;">
                    <h3 style="color: #F59E0B; margin-bottom: 10px;">‚ö° Silent Handoff</h3>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 20px;">Seamlessly transfer
                        your active
                        session and ledger state to another node via NetBird.</p>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 10px;">NETBIRD STATUS
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 10px; height: 10px; background: #10B981; border-radius: 50%;"></div>
                            <span
                                style="color: var(--text-main); font-family: 'JetBrains Mono'; font-size: 0.8rem;">connected_to_mesh_01</span>
                        </div>
                    </div>
                    <button class="btn-primary" style="width: 100%; background: #F59E0B;"
                        onclick="initiateHandoff()">Initiate Handoff Protocol</button>
                </div>

                <div class="glass-panel">
                    <h3>üõÇ Travel Documents</h3>
                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                        <div class="badge"
                            style="background: rgba(59, 130, 246, 0.1); color: #60A5FA; padding: 10px; text-align: center;">
                            Verified Sovereign Identity</div>
                        <div
                            style="font-size: 0.75rem; color: var(--text-muted); padding: 10px; border: 1px dashed rgba(16,185,129,0.1); border-radius: 8px;">
                            Your identity is cryptographically signed and ready for federation syncing.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: WIKI / KNOWLEDGE -->
    <div id="view-wiki" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üìö Village Library</h2>
            <p style="color: var(--text-muted);">Standard Operating Procedures (SOPs) and Knowledge Base.</p>
        </div>
        <!-- Wiki Container - populated by renderWikiUI() -->
        <div id="wiki-container" class="glass-panel"
            style="height: 80%; overflow: hidden; padding: 20px; background: rgba(15, 23, 42, 0.6);">
            <!-- Will be populated dynamically -->
        </div>
        <div style="margin-top: 10px; text-align: right;">
            <button class="btn-secondary"
                onclick="window.open('https://wiki.opensourceecology.org/wiki/User:Seeker/Abundance_Token/SOPs')">üåê
                Open on OSE Wiki</button>
        </div>
    </div>

    <!-- VIEW: STEWARD AI CHAT -->
    <div id="view-steward" class="app-view" style="display: none;">
        <!-- Populated by renderStewardChat() -->
        <div style="color:var(--text-muted); text-align:center; padding:60px;">Initializing Steward...</div>
    </div>

    <!-- VIEW: MYCELIUM STORE -->
    <div id="view-store" class="app-view" style="display: none;">
        <!-- Populated by renderMyceliumStore() -->
        <div style="color:var(--text-muted); text-align:center; padding:60px;">Loading The Mycelium...</div>
    </div>

    <!-- VIEW: HARDWARE / INFRASTRUCTURE -->
    <div id="view-hardware" class="app-view" style="display: none;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üõ†Ô∏è Infrastructure Monitor</h2>
            <p style="color: var(--text-muted);">Real-time telemetry from physical village nodes.</p>
        </div>
        <div id="hardware-monitor-container"></div>
    </div>

    <!-- VIEW: MAP -->
    <div id="view-map" class="app-view" style="display: none; height: 100%; position: relative;">
        <div id="village-map" style="width:100%; height:100%; border-radius:16px; z-index: 1;"></div>
    </div>

    <!-- VIEW: LIVE TANGLE -->
    <div id="view-tangle" class="app-view" style="display: none; height: 100%; flex-direction: column;">
        <div class="section-header" style="margin-bottom: 20px;">
            <h2>üï∏Ô∏è Live Tangle Stream</h2>
            <p style="color: var(--text-muted);">Real-time block propagation and network traffic visualization.</p>
        </div>
        <div class="glass-panel" style="flex: 1; position: relative; overflow: hidden; background: rgba(0,0,0,0.4);">
            <canvas id="tangle-canvas-large" style="width: 100%; height: 100%;"></canvas>
            <div style="position: absolute; top: 15px; right: 20px; display: flex; gap: 10px;">
                <div class="badge"
                    style="background: rgba(16,185,129,0.1); color: #10B981; border: 1px solid rgba(16,185,129,0.2);">
                    LIVE SIGNAL</div>
            </div>
        </div>
        <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 0.8rem; color: var(--text-muted);">
                Showing the last <span id="tangle-node-count" style="color: #10B981; font-weight: bold;">0</span>
                transactions syncing with the village
                ledger.
            </div>
            <button class="btn-secondary" onclick="window.trafficNodes = []">Clear Visualization</button>
        </div>
    </div>

    <!-- VIEW: TERMINAL CONSOLE -->
    <div id="view-console" class="app-view" style="display: none; height: 100%; padding: 0;">
        <iframe src="console.html" style="width: 100%; height: 100%; border: none; background: #000;"></iframe>
    </div>

    </main>
    </div>

    <!-- VIEW: AUTH (Login/Register) -->
    <div id="view-auth" class="app-view" style="display: none;">
        <div class="glass-panel" style="max-width: 400px; margin: 50px auto; text-align: center;">
            <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                <div class="logo-icon" style="width: 40px; height: 40px;"></div>
                <h1 style="font-size: 1.5rem;">Sovereign <span class="highlight">Identity</span></h1>
            </div>

            <!-- Toggle Switch -->
            <div
                style="display: flex; gap: 10px; margin-bottom: 20px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 8px;">
                <button onclick="showAuthMode('login')" id="btn-mode-login" class="btn-primary"
                    style="flex:1;">Login</button>
                <button onclick="showAuthMode('register')" id="btn-mode-register" class="btn-secondary"
                    style="flex:1; background:transparent;">Register</button>
            </div>

            <!-- LOGIN FORM -->
            <form id="auth-login-form" onsubmit="event.preventDefault(); window.performLogin();">
                <input type="text" id="login-username" class="input-dark" placeholder="Username"
                    style="width: 100%; margin-bottom: 10px; padding: 12px;" autocomplete="username">
                <input type="password" id="login-password" class="input-dark" placeholder="Password"
                    style="width: 100%; margin-bottom: 20px; padding: 12px;" autocomplete="current-password">
                <button type="submit" class="btn-primary" style="width: 100%;">Access System</button>
            </form>

            <!-- REGISTER FORM -->
            <form id="auth-register-form" style="display: none;"
                onsubmit="event.preventDefault(); window.performRegister();">
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 15px;">Create a Sovereign
                    Identity. You will
                    receive a 12-word Seed Phrase.</p>
                <input type="text" id="reg-username" class="input-dark" placeholder="Choose Username"
                    style="width: 100%; margin-bottom: 10px; padding: 12px;" autocomplete="username">
                <input type="password" id="reg-password" class="input-dark" placeholder="Set Password"
                    style="width: 100%; margin-bottom: 20px; padding: 12px;" autocomplete="new-password">
                <button type="submit" class="btn-primary" style="background: #8B5CF6; width: 100%;">Generate
                    Identity</button>
            </form>

            <!-- SEED DISPLAY (Hidden) -->
            <div id="auth-seed-display"
                style="display: none; margin-top: 20px; text-align: left; background: rgba(16, 185, 129, 0.1); padding: 15px; border: 1px dashed #10B981; border-radius: 8px;">
                <h4 style="color: #10B981; margin: 0 0 10px 0;">‚úÖ Registration Complete</h4>
                <p style="font-size: 0.8rem; color: var(--text-main);">SAVE THIS SEED PHRASE. It is your only backup.
                </p>
                <div id="seed-phrase-box"
                    style="font-family: 'JetBrains Mono'; background: #000; padding: 10px; color: var(--primary-light); border-radius: 4px; margin: 10px 0; word-spacing: 5px;">
                </div>
                <button onclick="showAuthMode('login')" class="btn-secondary" style="width: 100%; margin-top: 10px;">I
                    have saved it. Login.</button>
            </div>

            <div id="auth-error" style="color: #EF4444; font-size: 0.9rem; margin-top: 10px; display: none;"></div>
        </div>
    </div>

    <!-- VIEW: ADMIN DASHBOARD -->
    <div id="view-admin" class="app-view" style="display: none;">
        <div class="section-header">
            <h2>üõ°Ô∏è Admin Command Deck</h2>
            <p style="color: #F59E0B;">Protected Zone. Authorized Personnel Only.</p>
        </div>
        <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="glass-panel">
                <h3>System Controls</h3>
                <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn-secondary" style="text-align: left;">üîÑ Force Wiki Sync</button>
                    <button class="btn-secondary" style="text-align: left;">üßπ Prune Ghost Nodes</button>
                    <button class="btn-secondary"
                        style="text-align: left; color: #EF4444; border: 1px solid #EF4444;">üõë Emergency
                        Shutdown</button>
                </div>
            </div>
            <div class="glass-panel">
                <h3>User Registry</h3>
                <div style="margin-top: 10px; color: var(--text-muted); font-size: 0.9rem;">
                    User management coming in Alpha 3.1
                </div>
            </div>
        </div>
    </div>


    <!-- ONBOARDING MODAL -->
    <div id="onboarding-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; backdrop-filter: blur(5px);"
        onclick="window.closeOnboarding()"></div>
    <div id="onboarding-modal" class="onboarding-modal" style="display: none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0; color:var(--primary);">üöÄ Ark Onboarding</h2>
            <button onclick="window.closeOnboarding()"
                style="background:none; border:none; color:var(--text-muted); font-size:1.5rem; cursor:pointer;">&times;</button>
        </div>
        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:20px;">Complete these steps to synchronize
            your node with the federation.</p>

        <div style="margin-bottom:25px;">
            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:8px;">
                <span>VIBRANT NEURAL SYNC</span>
                <span id="onboarding-progress-text">0%</span>
            </div>
            <div
                style="width:100%; height:8px; background:rgba(255,255,255,0.05); border-radius:4px; overflow:hidden; border:1px solid rgba(16,185,129,0.1);">
                <div id="onboarding-progress-fill"
                    style="width:0%; height:100%; background:var(--primary); box-shadow:0 0 10px var(--primary-glow); transition:width 0.5s ease;">
                </div>
            </div>
        </div>

        <div id="onboarding-steps-container">
            <!-- JS Injected -->
        </div>

        <div
            style="margin-top:25px; padding-top:20px; border-top:1px solid rgba(255,255,255,0.05); display:flex; gap:10px;">
            <button onclick="window.closeOnboarding()" class="btn-primary" style="flex:1;">CONTINUE MISSION</button>
        </div>
    </div>

    <script src="sound_engine.js"></script>
    <script src="mobility_module.js"></script>
    <script src="bounty_board.js"></script>
    <script src="app.js?v=2.5"></script>

    <!-- n8n Chat Integration (Disabled until Webhook is ready) -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

        createChat({
            webhookUrl: '', 
            mode: 'window',
            showWelcomeScreen: true,
            initialMessages: [
                'Hello! I am the OSE Steward AI. How can I assist you with the Civilization OS?'
            ],
            i18n: {
                en: {
                    title: 'OSE Steward',
                    subtitle: 'Autonomous Operator',
                    footer: 'Powered by OSE Ark',
                    getStarted: 'New Conversation',
                    inputPlaceholder: 'Type your instruction...',
                },
            },
            style: {
                width: 400,
                height: 600,
                position: 'right',
                backgroundColor: '#0f172a',
                tokenColor: '#10B981',
                avatarBackgroundColor: '#10B981',
                avatarColor: '#ffffff',
                botMessageBackgroundColor: '#1e293b',
                botMessageColor: 'var(--text-main)',
                userMessageBackgroundColor: '#10B981',
                userMessageColor: '#ffffff',
            }
        });
    </script> -->
</body>

</html>