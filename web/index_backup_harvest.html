<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PIP-BOY 3000 | ARK OS</title>
    <link rel="stylesheet" href="style.css?v=3.1">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=VT323&display=swap" rel="stylesheet">
    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- App Logic -->
    <script src="app.js"></script>
    <script src="engagement.js"></script>
    <script src="activity_feed.js"></script>
    <script src="hardware_monitor.js"></script>
    <script src="mobility_module.js"></script>
    <script src="pipboy_enhancements.js"></script>
    <script src="admin_deck.js"></script>
    <script type="module" src="components/focus.js"></script>
    <script src="harvest_ui.js"></script>
</head>

<body>

    <!-- THE CHASSIS -->
    <div class="pip-boy-chassis">

        <!-- THE CRT SCREEN -->
        <div class="crt-screen">
            <div class="crt-overlay"></div> <!-- Scanlines -->

            <div class="screen-content" id="main-display">

                <!-- HEADER: Top Status Bar -->
                <div
                    style="display: flex; justify-content: space-between; border-bottom: 2px solid var(--pip-green); padding-bottom: 10px; margin-bottom: 20px;">
                    <div style="font-size: 1.2rem; font-weight: bold; cursor:pointer;" onclick="switchPipTab('deck')">
                        HP <span id="hp-stat">100/100</span>
                    </div>
                    <div style="font-size: 1.2rem; font-weight: bold;">
                        LEVEL <span id="lvl-stat">01</span> <span class="blink">‚ñÆ</span>
                    </div>
                    <div style="font-size: 1.2rem; font-weight: bold;">
                        AP <span id="ap-stat">85/100</span>
                    </div>
                </div>

                <!-- VIEW: STAT (Dashboard) -->
                <div id="view-stat" class="app-view">
                    <div class="pip-grid-2">
                        <div
                            style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <pre
                                style="font-family: 'VT323'; font-size: 10px; line-height: 10px; color: var(--pip-green);">
      .::-::.
    .::'   '::.
   .::       ::.
  .::         ::.
  ::           ::
  ::   .:::.   ::
  ::  .:::::.  ::
  ::  ':::::'  ::
  '::.       .::'
   '::.     .::'
     '::-::-'
      VAULT-TEC
                        </pre>
                            <div style="margin-top: 10px; text-align: center; font-size: 1.5rem;">
                                STATUS: <span style="color: var(--pip-green);">OPTIMAL</span>
                            </div>
                        </div>

                        <div>
                            <div class="pip-box">
                                <h3 style="margin: 0; border: none;">KARDASHEV SIGNAL</h3>
                                <div style="font-size: 2.5rem; font-weight: bold;" id="kardashev-realtime">0.7241</div>
                                <div class="pip-stat-row">
                                    <span>OUTPUT</span>
                                    <span>15.4 TW</span>
                                </div>
                            </div>

                            <div class="pip-box">
                                <h3 style="margin: 0; border: none;">LIMBIC SYSTEM</h3>
                                <div class="pip-bar-container" style="margin-top: 10px;">
                                    <div class="pip-bar-fill" style="width: 75%;"></div>
                                </div>
                                <div class="pip-stat-row">
                                    <span>MORALE</span>
                                    <span>STABLE</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin-top: 20px;">QUICK COMMANDS</h3>
                    <div class="pip-grid-3">
                        <button class="btn-pip" onclick="window.quickMint(1)">MINT 1H</button>
                        <button class="btn-pip" onclick="window.runDiagnostic()">DIAGNOSE</button>
                        <button class="btn-pip" onclick="window.toggleZenMode()">ZEN MODE</button>
                    </div>
                </div>

                <!-- VIEW: INV (Wallet) -->
                <div id="view-inv" class="app-view" style="display: none;">
                    <div class="pip-grid-2">
                        <div class="pip-box">
                            <h3>CAPS (AT)</h3>
                            <div style="font-size: 3rem; font-weight: bold;" id="wallet-balance">0.00</div>
                            <div class="pip-stat-row">
                                <span>HOURLY RATE</span>
                                <span>10.0 AT/HR</span>
                            </div>
                        </div>
                        <div class="pip-box">
                            <h3>INVENTORY</h3>
                            <ul class="terminal-list">
                                <li class="terminal-item">
                                    <span>Starter Kit</span>
                                    <span>1</span>
                                </li>
                                <li class="terminal-item">
                                    <span>Stimpack</span>
                                    <span>0</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <h3>ACTIONS</h3>
                    <div class="pip-grid-3">
                        <button class="btn-pip" onclick="window.renderSendModal()">TRANSFER</button>
                        <button class="btn-pip" onclick="window.renderExchangeUI()">BARTER</button>
                        <button class="btn-pip" onclick="window.renderCodeMintModal()">CRAFT</button>
                    </div>
                </div>

                <!-- VIEW: DATA (Quests/Wiki/Tech Tree) -->
                <div id="view-data" class="app-view" style="display: none;">
                    <div class="pip-grid-2" style="grid-template-columns: 1fr 1.5fr;">
                        <div style="border-right: 1px solid var(--pip-dim); padding-right: 15px;">
                            <h3 style="margin-top:0;">ARCHIVES</h3>
                            <button class="btn-pip" style="width:100%; margin-bottom:10px;"
                                onclick="window.switchView('wiki')">LIBRARY</button>
                            <button class="btn-pip" style="width:100%; margin-bottom:10px;"
                                onclick="window.switchView('chronicle')">LOGS</button>

                            <h3 style="margin-top: 10px;">QUESTS</h3>
                            <ul class="terminal-list" id="active-missions-list">
                                <li class="terminal-item"><span>Loading quests...</span></li>
                            </ul>
                        </div>
                        <div style="padding-left: 15px;">
                            <h3 style="margin-top:0;">TECH TREE</h3>
                            <div id="tech-tree-content" class="tech-tree-container">
                                <!-- Injected via pipboy_enhancements.js -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: MAP -->
                <div id="view-map" class="app-view" style="display: none;">
                    <div class="pip-box" style="padding: 0; min-height: 400px; border: 2px solid var(--pip-green);">
                        <div id="mobility-map"
                            style="filter: sepia(100%) hue-rotate(90deg) invert(100%) brightness(0.8) contrast(1.5);">
                        </div>
                    </div>
                    <div class="pip-stat-row" style="margin-top:10px;">
                        <span id="current-node-name">NODE: V-001 (FACTOR E FARM)</span>
                        <span id="mobility-status-badge">üõ∞Ô∏è SIGNAL STABLE</span>
                    </div>
                </div>

                <!-- VIEW: ADMIN DECK (God Mode) -->
                <div id="view-deck" class="app-view" style="display: none;">
                    <div id="view-admin-deck">
                        <!-- Injected by admin_deck.js -->
                    </div>
                </div>

                <!-- VIEW: RADIO (Comms) -->
                <div id="view-radio" class="app-view" style="display: none;">
                    <div class="pip-box" style="height: 350px; overflow-y: auto;">
                        <div id="terminal-log" style="font-size: 0.96rem; font-family: 'VT323', monospace;">
                            <div style="color: var(--pip-dim);">[SYSTEM] RADIO FREQUENCY OPEN...</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <input type="text" id="chat-input" placeholder="BROADCAST MESSAGE..."
                            onkeyup="if(event.key==='Enter') window.sendChat()">
                        <button class="btn-pip" onclick="window.sendChat()">TX</button>
                    </div>
                </div>

                <!-- VIEW: FOCUS (Deep Work) -->
                <div id="view-focus" class="app-view" style="display: none;">
                    <div class="pip-grid-2">
                        <div class="pip-box" style="text-align: center; border: 3px solid var(--pip-green);">
                            <h2 style="font-size: 2rem; margin: 0;">MONK MODE</h2>
                            <div id="focus-progress-container"
                                style="position: relative; width: 150px; height: 150px; margin: 20px auto;">
                                <div id="focus-timer"
                                    style="font-size: 3rem; font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    25:00</div>
                                <svg width="150" height="150">
                                    <circle cx="75" cy="75" r="70" fill="none" stroke="var(--pip-dim)"
                                        stroke-width="10" />
                                    <circle id="focus-progress-circle" cx="75" cy="75" r="70" fill="none"
                                        stroke="var(--pip-green)" stroke-width="10" stroke-dasharray="440"
                                        stroke-dashoffset="440" transform="rotate(-90 75 75)"
                                        style="transition: stroke-dashoffset 1s linear;" />
                                </svg>
                            </div>
                            <div id="focus-status" style="font-size: 1.5rem; color: var(--pip-green);">üí§ IDLE</div>
                        </div>
                        <div class="pip-box">
                            <h3 style="margin-top:0;">CONTROL</h3>
                            <div class="pip-grid-2" style="gap: 10px;">
                                <button class="btn-pip" onclick="FocusMode.start(25)">25 MIN</button>
                                <button class="btn-pip" onclick="FocusMode.start(60)">60 MIN</button>
                                <button class="btn-pip"
                                    style="grid-column: span 2; border-color: #ff5555; color: #ff5555;"
                                    onclick="FocusMode.stop()">ABORT SESSION</button>
                            </div>
                            <h3 style="margin-top: 20px;">QUOTES</h3>
                            <div id="focus-quote" style="font-style: italic; color: var(--pip-dim);">"Small steps make
                                big changes."</div>
                        </div>
                    </div>
                </div>

            </div> <!-- End Screen Content -->
        </div> <!-- End CRT Screen -->

        <!-- PHYSICAL NAV TABS -->
        <div class="pip-nav-container">
            <button class="pip-tab active" onclick="switchPipTab('stat')">STAT</button>
            <button class="pip-tab" onclick="switchPipTab('inv')">INV</button>
            <button class="pip-tab" onclick="switchPipTab('data')">DATA</button>
            <button class="pip-tab" onclick="switchPipTab('map')">MAP</button>
            <button class="pip-tab" onclick="switchPipTab('focus')">FOCUS</button>
            <button class="pip-tab" onclick="switchPipTab('harvest')">HARVEST</button>
            <button class="pip-tab" onclick="switchPipTab('radio')">RADIO</button>
        </div>

    </div>

    <!-- INLINE INIT -->
    <script>
        function switchPipTab(tabName) {
            document.querySelectorAll('.pip-tab').forEach(t => t.classList.remove('active'));
            const activeBtn = document.querySelector(`.pip-tab[onclick*="'${tabName}'"]`);
            if (activeBtn) activeBtn.classList.add('active');

            document.querySelectorAll('.app-view').forEach(v => v.style.display = 'none');
            const view = document.getElementById('view-' + tabName);
            if (view) view.style.display = 'block';

            // Enhancement dispatch
            if (window.switchPipTabHook) window.switchPipTabHook(tabName);
        }
    </script>

</body>

</html>